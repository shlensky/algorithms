<script>
  let primes = [2];

  function isPrime(n) {
    for (let i = 0; i < primes.length; i++) {
      if (n % primes[i] === 0) return false;
    }

    let lastCalculatedPrime = primes[primes.length - 1];
    for (let i = lastCalculatedPrime; i < n; i++) {
      if (n % i === 0) return false;
    }

    return true;
  }

  function findPrimes(max) {
    let lastCalculatedPrime = primes[primes.length - 1];

    // Already have cached results
    if (lastCalculatedPrime > max) {
      let end = primes.findIndex((i) => i > max);
      console.log('return fully cached result for max === ' + max);
      return primes.slice(0, end);
    }

    console.log('start calculating primes starting from ' + lastCalculatedPrime);
    for (let i = lastCalculatedPrime; i <= max; ++i) {
      if (isPrime(i)) {
        primes.push(i);
      }
    }

    return primes;
  }

  console.log(findPrimes(200));
  console.log(findPrimes(12));
  console.log(findPrimes(120));
  console.log(findPrimes(300));
  console.log(findPrimes(5000));
</script>
